description "Docker Registry start"

start on runlebel [3]
stop on shutdown

expect fork

script
      cd {{ project_root }}/docker-registry
      GUNICORN_WORKERS=${GUNICORN_WORKERS:-4}
      REGISTRY_PORT=${REGISTRY_PORT:-5000}
      GUNICORN_GRACEFUL_TIMEOUT=${GUNICORN_GRACEFUL_TIMEOUT:-3600}
      GUNICORN_SILENT_TIMEOUT=${GUNICORN_SILENT_TIMEOUT:-3600}

      gunicorn --access-logfile - --debug --max-requests 100 --graceful-timeout $GUNICORN_GRACEFUL_TIMEOUT -t $GUNICORN_SILENT_TIMEOUT -k gevent -b 0.0.0.0:$REGISTRY_PORT -w $GUNICORN_WORKERS wsgi:application &

      emit docker-registry_running
end script