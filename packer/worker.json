{
  "variables": {
    "os_username": "{{env `SDK_USERNAME`}}",
    "os_token": "{{env `SDK_TOKEN`}}"
  },

  "builders": [
    {
      "type":          "openstack",
      "region":        "IAD",
      "ssh_username":  "root",
      "image_name":    "vexor_ci.worker {{timestamp}}",
      "source_image":  "2ab974de-9fe5-4f5b-9d58-766a59f3de61",
      "flavor":        "performance1-4",
      "provider":      "rackspace-us"
    }
  ],
  "provisioners": [
    {
      "type":          "shell",
      "script":        "packer/before.sh"
    },
    {
      "type":          "file",
      "source":        "packer/upload.tgz",
      "destination":   "/tmp/provision/upload.tgz"
    },
    {
      "type":          "shell",
      "script":        "packer/provision.sh"
    },
    {
      "type":          "shell",
      "script":        "packer/rackspace.sh",
      "environment_vars": [
        "OS_REGION_NAME=IAD",
        "OS_PASSWORD={{user `os_token`}}",
        "OS_USERNAME={{user `os_username`}}"
      ]
    }
  ]
}
